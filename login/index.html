<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raven Panel - مدیریت حساب‌های بازی</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* Custom styles for Raven Panel */
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --background: #0f172a;
            --surface: #1e293b;
            --surface-hover: #334155;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #334155;
            --gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background);
            color: var(--text);
            min-height: 100vh;
            direction: rtl;
        }

        .glass-effect {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 1rem;
        }

        .gradient-bg {
            background: var(--gradient);
        }

        .server-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .server-asia { background-color: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .server-eu { background-color: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .server-americas { background-color: rgba(16, 185, 129, 0.2); color: #10b981; }

        .rank-bronze { color: #cd7f32; }
        .rank-silver { color: #c0c0c0; }
        .rank-gold { color: #ffd700; }
        .rank-platinum { color: #e5e4e2; }
        .rank-diamond { color: #b9f2ff; }
        .rank-master { color: #9370db; }
        .rank-legend { color: #ff4500; }
        .rank-mythic { color: #ff1493; }

        .status-online { 
            width: 0.75rem; 
            height: 0.75rem; 
            border-radius: 50%; 
            background-color: #10b981; 
        }

        .status-offline { 
            width: 0.75rem; 
            height: 0.75rem; 
            border-radius: 50%; 
            background-color: #6b7280; 
        }

        .user-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .user-card:hover {
            transform: scale(1.05);
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .input-field {
            background-color: var(--background);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            width: 100%;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.5);
        }

        .input-wrapper {
            position: relative;
        }

        .input-icon {
            position: absolute;
            right: 0.75rem;
            top: 0.75rem;
            color: var(--text-muted);
            z-index: 10;
        }

        .loading-spinner {
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            width: 1.25rem;
            height: 1.25rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Fix for input padding with icons */
        .input-field.pr-10 {
            padding-right: 2.5rem;
        }

        /* Ensure buttons are clickable */
        button[data-action] {
            pointer-events: auto;
        }

        button[data-action]:hover {
            opacity: 0.8;
        }

        /* Fix for user card clicks */
        .user-card[data-action] {
            pointer-events: auto;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .user-grid {
                grid-template-columns: 1fr;
            }
            
            .profile-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Content will be rendered by JavaScript -->
    </div>

    <script>
        // Raven Panel - Game Account Management System
        class RavenPanel {
            constructor() {
                this.state = {
                    isLogin: true,
                    showPassword: false,
                    isLoggedIn: false,
                    currentUser: null,
                    users: [],
                    selectedServer: 'all',
                    selectedUser: null,
                    loading: false,
                    formData: {
                        username: '',
                        email: '',
                        gameId: '',
                        server: 'ASIA',
                        level: 1,
                        rank: 'Bronze',
                        password: ''
                    }
                };

                this.servers = [
                    { id: 'ASIA', name: 'ASIA', color: '#ef4444' },
                    { id: 'EU - MENA', name: 'EU - MENA', color: '#3b82f6' },
                    { id: 'AMERICAS', name: 'AMERICAS', color: '#10b981' }
                ];

                this.ranks = [
                    { id: 'Bronze', name: 'Bronze', color: '#cd7f32' },
                    { id: 'Silver', name: 'Silver', color: '#c0c0c0' },
                    { id: 'Gold', name: 'Gold', color: '#ffd700' },
                    { id: 'Platinum', name: 'Platinum', color: '#e5e4e2' },
                    { id: 'Diamond', name: 'Diamond', color: '#b9f2ff' },
                    { id: 'Master', name: 'Master', color: '#9370db' },
                    { id: 'Legend', name: 'Legend', color: '#ff4500' },
                    { id: 'Mythic', name: 'Mythic', color: '#ff1493' }
                ];

                this.apiBaseUrl = 'https://ravenshoppanel.bloodstrike.workers.dev/'; // Change this to your worker URL
                
                this.init();
            }

            init() {
                console.log('Initializing Raven Panel...');
                this.loadFromLocalStorage();
                this.render();
                this.setupEventListeners();
                console.log('Raven Panel initialized successfully!');
            }

            loadFromLocalStorage() {
                const storedUsers = localStorage.getItem('gameUsers');
                if (storedUsers) {
                    this.state.users = JSON.parse(storedUsers);
                } else {
                    // Initial mock data
                    const initialUsers = [
                        {
                            id: 1,
                            username: 'SkyStriker',
                            email: 'sky@example.com',
                            gameId: 'SKY001',
                            server: 'ASIA',
                            level: 47,
                            rank: 'Diamond',
                            joinDate: '2023-01-15',
                            lastActive: '2024-01-20',
                            status: 'online'
                        },
                        {
                            id: 2,
                            username: 'ShadowRaven',
                            email: 'shadow@example.com',
                            gameId: 'SHD002',
                            server: 'EU - MENA',
                            level: 41,
                            rank: 'Master',
                            joinDate: '2023-02-20',
                            lastActive: '2024-01-19',
                            status: 'offline'
                        },
                        {
                            id: 3,
                            username: 'GreenBlade',
                            email: 'green@example.com',
                            gameId: 'GRN003',
                            server: 'AMERICAS',
                            level: 44,
                            rank: 'Platinum',
                            joinDate: '2023-03-10',
                            lastActive: '2024-01-18',
                            status: 'online'
                        }
                    ];
                    this.state.users = initialUsers;
                    localStorage.setItem('gameUsers', JSON.stringify(initialUsers));
                }
            }

            setupEventListeners() {
                console.log('Setting up event listeners...');
                
                document.addEventListener('click', (e) => {
                    console.log('Click detected on:', e.target);
                    
                    // Check if clicked element has data-action
                    if (e.target.matches('[data-action]')) {
                        console.log('Action found:', e.target.dataset.action);
                        e.preventDefault();
                        e.stopPropagation();
                        this.handleAction(e.target.dataset.action, e);
                    }
                    
                    // Check if clicked element is inside a button with data-action
                    const actionButton = e.target.closest('[data-action]');
                    if (actionButton && actionButton !== e.target) {
                        console.log('Action found in parent:', actionButton.dataset.action);
                        e.preventDefault();
                        e.stopPropagation();
                        this.handleAction(actionButton.dataset.action, e);
                    }
                });

                document.addEventListener('change', (e) => {
                    if (e.target.matches('[data-input]')) {
                        this.handleInput(e.target.dataset.input, e.target.value, e.target);
                    }
                });

                document.addEventListener('submit', (e) => {
                    console.log('Submit detected on:', e.target);
                    if (e.target.matches('#auth-form')) {
                        console.log('Form submit intercepted');
                        e.preventDefault();
                        e.stopPropagation();
                        this.handleSubmit();
                    }
                });
            }

            handleAction(action, event) {
                console.log('Handling action:', action);
                
                switch (action) {
                    case 'toggle-auth':
                        console.log('Toggling auth mode');
                        this.state.isLogin = !this.state.isLogin;
                        this.render();
                        break;
                    case 'toggle-password':
                        console.log('Toggling password visibility');
                        this.state.showPassword = !this.state.showPassword;
                        this.render();
                        break;
                    case 'logout':
                        console.log('Logging out');
                        this.state.isLoggedIn = false;
                        this.state.currentUser = null;
                        this.render();
                        break;
                    case 'select-server':
                        console.log('Selecting server:', event.target.dataset.server);
                        this.state.selectedServer = event.target.dataset.server;
                        this.fetchUsers();
                        break;
                    case 'view-user':
                        const userId = parseInt(event.target.dataset.userId);
                        console.log('Viewing user:', userId);
                        this.viewUser(userId);
                        break;
                    case 'back-to-users':
                        console.log('Back to users list');
                        this.state.selectedUser = null;
                        this.render();
                        break;
                    default:
                        console.log('Unknown action:', action);
                }
            }

            handleInput(input, value, element) {
                if (input === 'level') {
                    const numValue = parseInt(value);
                    if (numValue >= 1 && numValue <= 50) {
                        this.state.formData[input] = numValue;
                    }
                } else {
                    this.state.formData[input] = value;
                }
            }

            async handleSubmit() {
                console.log('Form submitted!');
                console.log('Is login mode:', this.state.isLogin);
                console.log('Form data:', this.state.formData);
                
                this.state.loading = true;
                this.render();

                try {
                    const endpoint = this.state.isLogin ? '/api/login' : '/api/register';
                    console.log('Calling API endpoint:', endpoint);
                    
                    const response = await fetch(`${this.apiBaseUrl}${endpoint}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(this.state.formData)
                    });
                    
                    const data = await response.json();
                    console.log('API response:', data);
                    
                    if (data.success) {
                        if (!this.state.isLogin) {
                            this.addUserToLocalStorage();
                        }
                        
                        this.state.currentUser = data.user || {
                            id: Date.now(),
                            username: this.state.formData.username,
                            email: this.state.formData.email,
                            gameId: this.state.formData.gameId,
                            server: this.state.formData.server,
                            level: this.state.formData.level,
                            rank: this.state.formData.rank
                        };
                        this.state.isLoggedIn = true;
                        console.log('Login successful!');
                    } else {
                        alert(data.message || 'Operation failed');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    console.log('Using fallback mode for demo');
                    
                    // Fallback for demo
                    if (!this.state.isLogin) {
                        this.addUserToLocalStorage();
                    }
                    
                    this.state.currentUser = {
                        id: Date.now(),
                        username: this.state.formData.username,
                        email: this.state.formData.email,
                        gameId: this.state.formData.gameId,
                        server: this.state.formData.server,
                        level: this.state.formData.level,
                        rank: this.state.formData.rank
                    };
                    this.state.isLoggedIn = true;
                    console.log('Fallback login successful!');
                } finally {
                    this.state.loading = false;
                    this.render();
                }
            }

            addUserToLocalStorage() {
                const newUser = {
                    id: Date.now(),
                    username: this.state.formData.username,
                    email: this.state.formData.email,
                    gameId: this.state.formData.gameId,
                    server: this.state.formData.server,
                    level: this.state.formData.level,
                    rank: this.state.formData.rank,
                    joinDate: new Date().toISOString().split('T')[0],
                    lastActive: new Date().toISOString().split('T')[0],
                    status: 'online'
                };
                
                const storedUsers = localStorage.getItem('gameUsers');
                let allUsers = storedUsers ? JSON.parse(storedUsers) : [];
                allUsers.push(newUser);
                localStorage.setItem('gameUsers', JSON.stringify(allUsers));
                this.state.users = allUsers;
            }

            async fetchUsers() {
                this.state.loading = true;
                this.render();

                try {
                    const response = await fetch(`${this.apiBaseUrl}/api/users${this.state.selectedServer !== 'all' ? `?server=${this.state.selectedServer}` : ''}`);
                    const data = await response.json();
                    if (data.success) {
                        this.state.users = data.users;
                    }
                } catch (error) {
                    console.error('Error fetching users:', error);
                    // Use localStorage data as fallback
                    const storedUsers = localStorage.getItem('gameUsers');
                    if (storedUsers) {
                        const allUsers = JSON.parse(storedUsers);
                        if (this.state.selectedServer !== 'all') {
                            this.state.users = allUsers.filter(u => u.server === this.state.selectedServer);
                        } else {
                            this.state.users = allUsers;
                        }
                    }
                } finally {
                    this.state.loading = false;
                    this.render();
                }
            }

            viewUser(userId) {
                const user = this.state.users.find(u => u.id === userId);
                if (user) {
                    this.state.selectedUser = user;
                    this.updateUserLastActive(userId);
                    this.render();
                }
            }

            updateUserLastActive(userId) {
                const storedUsers = localStorage.getItem('gameUsers');
                if (storedUsers) {
                    let allUsers = JSON.parse(storedUsers);
                    const userIndex = allUsers.findIndex(u => u.id === userId);
                    if (userIndex !== -1) {
                        allUsers[userIndex].lastActive = new Date().toISOString().split('T')[0];
                        allUsers[userIndex].status = 'online';
                        localStorage.setItem('gameUsers', JSON.stringify(allUsers));
                        this.state.users = allUsers;
                    }
                }
            }

            render() {
                const app = document.getElementById('app');
                
                if (this.state.selectedUser) {
                    app.innerHTML = this.renderUserProfile();
                } else if (this.state.isLoggedIn) {
                    app.innerHTML = this.renderDashboard();
                } else {
                    app.innerHTML = this.renderAuth();
                }

                // Re-initialize Lucide icons
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }

            renderAuth() {
                return `
                    <div class="min-h-screen flex items-center justify-center p-4 fade-in">
                        <div class="w-full max-w-md">
                            <div class="text-center mb-8">
                                <div class="w-20 h-20 mx-auto mb-4 rounded-2xl flex items-center justify-center gradient-bg">
                                    <i data-lucide="gamepad-2" class="w-9 h-9 text-white"></i>
                                </div>
                                <h1 class="text-3xl font-bold mb-2 text-white">Raven Panel</h1>
                                <p class="text-gray-400">مدیریت حساب‌های بازی</p>
                            </div>

                            <div class="glass-effect p-8">
                                <div class="flex mb-6 bg-gray-800 rounded-lg p-1">
                                    <button 
                                        data-action="toggle-auth"
                                        class="flex-1 py-2 px-4 rounded-md font-medium transition-all cursor-pointer ${
                                            this.state.isLogin ? 'shadow-lg' : ''
                                        }"
                                        style="background-color: ${this.state.isLogin ? 'var(--primary)' : 'transparent'}; color: ${this.state.isLogin ? 'white' : 'var(--text-muted)'}"
                                    >
                                        ورود
                                    </button>
                                    <button 
                                        data-action="toggle-auth"
                                        class="flex-1 py-2 px-4 rounded-md font-medium transition-all cursor-pointer ${
                                            !this.state.isLogin ? 'shadow-lg' : ''
                                        }"
                                        style="background-color: ${!this.state.isLogin ? 'var(--primary)' : 'transparent'}; color: ${!this.state.isLogin ? 'white' : 'var(--text-muted)'}"
                                    >
                                        ثبت‌نام
                                    </button>
                                </div>

                                <form id="auth-form" class="space-y-4">
                                    ${this.state.isLogin ? this.renderLoginFields() : this.renderRegisterFields()}
                                    
                                    <div>
                                        <label class="block text-sm font-medium mb-2 text-gray-300">رمز عبور</label>
                                        <div class="relative">
                                            <div class="absolute right-3 top-3 text-gray-400">
                                                <i data-lucide="lock" class="w-4 h-4"></i>
                                            </div>
                                            <input
                                                type="${this.state.showPassword ? 'text' : 'password'}"
                                                name="password"
                                                data-input="password"
                                                value="${this.state.formData.password}"
                                                class="input-field pr-10"
                                                placeholder="رمز عبور خود را وارد کنید"
                                                required
                                            />
                                            <button 
                                                type="button"
                                                data-action="toggle-password"
                                                class="absolute left-3 top-3 text-gray-400"
                                            >
                                                <i data-lucide="${this.state.showPassword ? 'eye-off' : 'eye'}" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <button
                                        type="submit"
                                        disabled="${this.state.loading}"
                                        class="btn-primary w-full flex items-center justify-center gap-2 cursor-pointer"
                                    >
                                        ${this.state.loading ? '<div class="loading-spinner"></div>' : ''}
                                        ${this.state.isLogin ? 'ورود' : 'ثبت‌نام'}
                                        <i data-lucide="arrow-left" class="w-4 h-4 rotate-180"></i>
                                    </button>
                                </form>

                                <div class="mt-6 text-center">
                                    <p class="text-gray-400">
                                        ${this.state.isLogin ? 'حساب کاربری ندارید؟' : 'قبلاً ثبت‌نام کرده‌اید؟'}
                                        <button
                                            data-action="toggle-auth"
                                            class="font-medium mr-2 cursor-pointer"
                                            style="color: var(--primary)"
                                        >
                                            ${this.state.isLogin ? 'ایجاد کنید' : 'وارد شوید'}
                                        </button>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderLoginFields() {
                return `
                    <div>
                        <label class="block text-sm font-medium mb-2 text-gray-300">ایمیل یا نام کاربری</label>
                        <div class="relative">
                            <div class="absolute right-3 top-3 text-gray-400">
                                <i data-lucide="user" class="w-4 h-4"></i>
                            </div>
                            <input
                                type="text"
                                name="username"
                                data-input="username"
                                value="${this.state.formData.username}"
                                class="input-field pr-10"
                                placeholder="نام کاربری یا ایمیل خود را وارد کنید"
                                required
                            />
                        </div>
                    </div>
                `;
            }

            renderRegisterFields() {
                return `
                    <div>
                        <label class="block text-sm font-medium mb-2 text-gray-300">نام کاربری</label>
                        <div class="relative">
                            <div class="absolute right-3 top-3 text-gray-400">
                                <i data-lucide="user" class="w-4 h-4"></i>
                            </div>
                            <input
                                type="text"
                                name="username"
                                data-input="username"
                                value="${this.state.formData.username}"
                                class="input-field pr-10"
                                placeholder="نام کاربری خود را وارد کنید"
                                required
                            />
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2 text-gray-300">ایمیل</label>
                        <div class="relative">
                            <div class="absolute right-3 top-3 text-gray-400">
                                <i data-lucide="mail" class="w-4 h-4"></i>
                            </div>
                            <input
                                type="email"
                                name="email"
                                data-input="email"
                                value="${this.state.formData.email}"
                                class="input-field pr-10"
                                placeholder="ایمیل خود را وارد کنید"
                                required
                            />
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2 text-gray-300">شناسه بازی</label>
                        <div class="relative">
                            <div class="absolute right-3 top-3 text-gray-400">
                                <i data-lucide="gamepad-2" class="w-4 h-4"></i>
                            </div>
                            <input
                                type="text"
                                name="gameId"
                                data-input="gameId"
                                value="${this.state.formData.gameId}"
                                class="input-field pr-10"
                                placeholder="شناسه بازی خود را وارد کنید"
                                required
                            />
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2 text-gray-300">سرور</label>
                        <div class="relative">
                            <div class="absolute right-3 top-3 text-gray-400">
                                <i data-lucide="globe" class="w-4 h-4"></i>
                            </div>
                            <select
                                name="server"
                                data-input="server"
                                value="${this.state.formData.server}"
                                class="input-field pr-10"
                            >
                                ${this.servers.map(server => `
                                    <option value="${server.id}">${server.name}</option>
                                `).join('')}
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2 text-gray-300">سطح</label>
                        <div class="relative">
                            <div class="absolute right-3 top-3 text-gray-400">
                                <i data-lucide="star" class="w-4 h-4"></i>
                            </div>
                            <input
                                type="number"
                                name="level"
                                data-input="level"
                                value="${this.state.formData.level}"
                                min="1"
                                max="50"
                                class="input-field pr-10"
                                placeholder="سطح خود را وارد کنید (1-50)"
                                required
                            />
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2 text-gray-300">رنک</label>
                        <div class="relative">
                            <div class="absolute right-3 top-3 text-gray-400">
                                <i data-lucide="trophy" class="w-4 h-4"></i>
                            </div>
                            <select
                                name="rank"
                                data-input="rank"
                                value="${this.state.formData.rank}"
                                class="input-field pr-10"
                            >
                                ${this.ranks.map(rank => `
                                    <option value="${rank.id}">${rank.name}</option>
                                `).join('')}
                            </select>
                        </div>
                    </div>
                `;
            }

            renderDashboard() {
                return `
                    <div class="min-h-screen p-4 fade-in">
                        <header class="glass-effect p-4 mb-6">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-4">
                                    <div class="w-12 h-12 rounded-xl flex items-center justify-center gradient-bg">
                                        <i data-lucide="gamepad-2" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div>
                                        <h1 class="text-2xl font-bold text-white">Raven Panel</h1>
                                        <p class="text-gray-400">مدیریت حساب‌های بازی</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center gap-4">
                                    <div class="text-left">
                                        <p class="text-sm text-gray-400">خوش آمدید</p>
                                        <p class="font-medium">${this.state.currentUser?.username || 'User'}</p>
                                    </div>
                                    <button
                                        data-action="logout"
                                        class="btn-primary"
                                    >
                                        خروج
                                    </button>
                                </div>
                            </div>
                        </header>

                        <main>
                            <div class="glass-effect p-6 mb-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h2 class="text-xl font-bold">لیست حساب‌های شما در سرورها</h2>
                                    <div class="flex gap-2">
                                        ${this.servers.map(server => `
                                            <button
                                                data-action="select-server"
                                                data-server="${server.id}"
                                                class="server-badge ${
                                                    this.state.selectedServer === server.id ? 'ring-2 ring-white' : ''
                                                } server-${server.id.toLowerCase().replace(' ', '-')}"
                                                style="background-color: ${this.state.selectedServer === server.id ? server.color : 'transparent'}; color: ${this.state.selectedServer === server.id ? 'white' : server.color}"
                                            >
                                                ${server.name}
                                            </button>
                                        `).join('')}
                                        <button
                                            data-action="select-server"
                                            data-server="all"
                                            class="server-badge ${
                                                this.state.selectedServer === 'all' ? 'ring-2 ring-white' : ''
                                            }"
                                            style="background-color: ${this.state.selectedServer === 'all' ? 'var(--primary)' : 'transparent'}; color: ${this.state.selectedServer === 'all' ? 'white' : 'var(--primary)'}"
                                        >
                                            همه
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="flex items-center gap-2 text-gray-400">
                                    <i data-lucide="users" class="w-4 h-4"></i>
                                    <span>موجود ${this.state.users.length} حساب</span>
                                </div>
                            </div>

                            ${this.state.loading ? `
                                <div class="flex justify-center items-center h-64">
                                    <div class="loading-spinner" style="width: 3rem; height: 3rem;"></div>
                                </div>
                            ` : `
                                <div class="user-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    ${this.state.users.map(user => this.renderUserCard(user)).join('')}
                                </div>
                            `}
                        </main>
                    </div>
                `;
            }

            renderUserCard(user) {
                const serverClass = `server-${user.server.toLowerCase().replace(' ', '-')}`;
                const rankClass = `rank-${user.rank.toLowerCase()}`;
                
                return `
                    <div 
                        class="user-card glass-effect p-6"
                        data-action="view-user"
                        data-user-id="${user.id}"
                    >
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-full gradient-bg flex items-center justify-center">
                                    <i data-lucide="user" class="w-6 h-6 text-white"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg">${user.username}</h3>
                                    <p class="text-sm text-gray-400">${user.email}</p>
                                </div>
                            </div>
                            <div class="${user.status === 'online' ? 'status-online' : 'status-offline'}"></div>
                        </div>
                        
                        <div class="space-y-2">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-400">سرور:</span>
                                <span class="server-badge ${serverClass}">${user.server}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-400">سطح:</span>
                                <span class="font-medium">Lv.${user.level}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-400">رنک:</span>
                                <span class="font-medium ${rankClass}">${user.rank}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-400">آخرین فعالیت:</span>
                                <span class="text-sm">${user.lastActive}</span>
                            </div>
                        </div>
                        
                        <button 
                            data-action="view-user"
                            data-user-id="${user.id}"
                            class="btn-primary w-full mt-4"
                        >
                            مشاهده پروفایل
                        </button>
                    </div>
                `;
            }

            renderUserProfile() {
                const user = this.state.selectedUser;
                const serverClass = `server-${user.server.toLowerCase().replace(' ', '-')}`;
                const rankClass = `rank-${user.rank.toLowerCase()}`;
                
                return `
                    <div class="min-h-screen p-4 fade-in">
                        <header class="glass-effect p-4 mb-6">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-4">
                                    <button
                                        data-action="back-to-users"
                                        class="btn-primary"
                                    >
                                        <i data-lucide="arrow-right" class="w-4 h-4"></i>
                                        بازگشت
                                    </button>
                                    <div>
                                        <h1 class="text-2xl font-bold text-white">پروفایل کاربر</h1>
                                        <p class="text-gray-400">${user.username}</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center gap-4">
                                    <div class="text-left">
                                        <p class="text-sm text-gray-400">خوش آمدید</p>
                                        <p class="font-medium">${this.state.currentUser?.username || 'User'}</p>
                                    </div>
                                    <button
                                        data-action="logout"
                                        class="btn-primary"
                                    >
                                        خروج
                                    </button>
                                </div>
                            </div>
                        </header>

                        <main class="max-w-4xl mx-auto">
                            <div class="glass-effect p-8">
                                <div class="flex flex-col md:flex-row gap-8">
                                    <div class="flex-shrink-0">
                                        <div class="w-32 h-32 rounded-full gradient-bg flex items-center justify-center">
                                            <i data-lucide="user" class="w-16 h-16 text-white"></i>
                                        </div>
                                        <div class="mt-4 text-center">
                                            <div class="${user.status === 'online' ? 'status-online' : 'status-offline'} mx-auto mb-2"></div>
                                            <p class="text-sm text-gray-400">${user.status === 'online' ? 'آنلاین' : 'آفلاین'}</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex-1">
                                        <div class="profile-grid grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <div>
                                                <h3 class="text-lg font-bold mb-4">اطلاعات اصلی</h3>
                                                <div class="space-y-3">
                                                    <div class="flex justify-between">
                                                        <span class="text-gray-400">نام کاربری:</span>
                                                        <span class="font-medium">${user.username}</span>
                                                    </div>
                                                    <div class="flex justify-between">
                                                        <span class="text-gray-400">ایمیل:</span>
                                                        <span class="font-medium">${user.email}</span>
                                                    </div>
                                                    <div class="flex justify-between">
                                                        <span class="text-gray-400">شناسه بازی:</span>
                                                        <span class="font-medium">${user.gameId}</span>
                                                    </div>
                                                    <div class="flex justify-between">
                                                        <span class="text-gray-400">سرور:</span>
                                                        <span class="server-badge ${serverClass}">${user.server}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div>
                                                <h3 class="text-lg font-bold mb-4">اطلاعات بازی</h3>
                                                <div class="space-y-3">
                                                    <div class="flex justify-between">
                                                        <span class="text-gray-400">سطح:</span>
                                                        <span class="font-medium">Lv.${user.level}</span>
                                                    </div>
                                                    <div class="flex justify-between">
                                                        <span class="text-gray-400">رنک:</span>
                                                        <span class="font-medium ${rankClass}">${user.rank}</span>
                                                    </div>
                                                    <div class="flex justify-between">
                                                        <span class="text-gray-400">تاریخ پیوستن:</span>
                                                        <span class="font-medium">${user.joinDate}</span>
                                                    </div>
                                                    <div class="flex justify-between">
                                                        <span class="text-gray-400">آخرین فعالیت:</span>
                                                        <span class="font-medium">${user.lastActive}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="mt-8 flex gap-4">
                                            <button class="btn-primary">
                                                <i data-lucide="edit" class="w-4 h-4"></i>
                                                ویرایش اطلاعات
                                            </button>
                                            <button class="btn-primary">
                                                <i data-lucide="settings" class="w-4 h-4"></i>
                                                تنظیمات
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </main>
                    </div>
                `;
            }
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, starting Raven Panel...');
            new RavenPanel();
        });
    </script>
</body>
</html>